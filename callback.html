<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TikTok Callback</title>
</head>
<body>
  <h1>ログイン処理中...</h1>
  <pre id="output"></pre>

  <script>
    // === 必ず変更する箇所 ===
    const CLIENT_KEY = "sbawycgi05v42vjdfh"; // ### CHANGE HERE ### 自分のClient Key
    const CLIENT_SECRET = "9065DsDZ3SmIeOfHvXKAgxm9CsKH4sq3"; // ### CHANGE HERE ###
    const REDIRECT_URI = "https://tiktok-policy.vercel.app/callback"; // ### CHANGE HERE ###

    async function exchangeCodeForToken(code) {
      const url = "https://open.tiktokapis.com/v2/oauth/token/";

      const body = {
        client_key: CLIENT_KEY,
        client_secret: CLIENT_SECRET,
        code: code,
        grant_type: "authorization_code",
        redirect_uri: REDIRECT_URI
      };

      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      return await res.json();
    }

    (async () => {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      const error = params.get("error");

      if (error) {
        document.getElementById("output").textContent = `エラー: ${error}`;
        return;
      }

      if (code) {
        const tokenData = await exchangeCodeForToken(code);
        document.getElementById("output").textContent = JSON.stringify(tokenData, null, 2);
      } else {
        document.getElementById("output").textContent = "コードがありません";
      }
    })();
  </script>
</body>
</html>
